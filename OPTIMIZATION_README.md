# üöÄ –û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è KavaCRM

## üìã –ó–º—ñ—Å—Ç
- [–û–≥–ª—è–¥ –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ–π](#–æ–≥–ª—è–¥-–æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ–π)
- [JavaScript –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó](#javascript-–æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó)
- [CSS –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó](#css-–æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó)
- [Backend –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó](#backend-–æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó)
- [–ë–∞–∑–∞ –¥–∞–Ω–∏—Ö](#–±–∞–∑–∞-–¥–∞–Ω–∏—Ö)
- [–ö–µ—à—É–≤–∞–Ω–Ω—è](#–∫–µ—à—É–≤–∞–Ω–Ω—è)
- [–Ü–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó –ø–æ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—é](#—ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó-–ø–æ-–≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—é)

## üéØ –û–≥–ª—è–¥ –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ–π

### ‚úÖ –í–∏–∫–æ–Ω–∞–Ω—ñ –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó:

1. **JavaScript**
   - –ö–µ—à—É–≤–∞–Ω–Ω—è DOM –µ–ª–µ–º–µ–Ω—Ç—ñ–≤
   - –û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è –æ–±—Ä–æ–±–Ω–∏–∫—ñ–≤ –ø–æ–¥—ñ–π
   - –ü–æ–∫—Ä–∞—â–µ–Ω–∞ –æ–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫
   - –ú–æ–¥—É–ª—å–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–¥—É

2. **CSS**
   - CSS –∑–º—ñ–Ω–Ω—ñ –¥–ª—è –ª–µ–≥–∫–æ–≥–æ –∫–µ—Ä—É–≤–∞–Ω–Ω—è
   - –ê–¥–∞–ø—Ç–∏–≤–Ω–∏–π –¥–∏–∑–∞–π–Ω
   - –ü–æ–∫—Ä–∞—â–µ–Ω–∞ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å
   - –ü—ñ–¥—Ç—Ä–∏–º–∫–∞ —Ç–µ–º–Ω–æ—ó —Ç–µ–º–∏

3. **Backend (Django)**
   - –ö–µ—à—É–≤–∞–Ω–Ω—è –∑–∞–ø–∏—Ç—ñ–≤
   - –û–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω—ñ –∑–∞–ø–∏—Ç–∏ –¥–æ –ë–î
   - –ü–æ–∫—Ä–∞—â–µ–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–¥—É
   - –û–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫

4. **–ë–∞–∑–∞ –¥–∞–Ω–∏—Ö**
   - –†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω—ñ —ñ–Ω–¥–µ–∫—Å–∏
   - –û–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω—ñ –∑–∞–ø–∏—Ç–∏
   - –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ

## üîß JavaScript –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó

### –û—Å–Ω–æ–≤–Ω—ñ –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è:

```javascript
// –ö–µ—à—É–≤–∞–Ω–Ω—è DOM –µ–ª–µ–º–µ–Ω—Ç—ñ–≤
const AppCache = {
    elements: new Map(),
    getElement: function(id) {
        if (!this.elements.has(id)) {
            this.elements.set(id, document.getElementById(id));
        }
        return this.elements.get(id);
    }
};

// –ö–µ—à –¥–ª—è –æ–±—á–∏—Å–ª–µ–Ω—å
const CalculationCache = {
    cache: new Map(),
    get: function(key) { return this.cache.get(key); },
    set: function(key, value) { this.cache.set(key, value); }
};
```

### –ü–µ—Ä–µ–≤–∞–≥–∏:
- ‚ö° –®–≤–∏–¥—à–∏–π –¥–æ—Å—Ç—É–ø –¥–æ DOM –µ–ª–µ–º–µ–Ω—Ç—ñ–≤
- üíæ –ó–º–µ–Ω—à–µ–Ω–Ω—è –ø–æ–≤—Ç–æ—Ä–Ω–∏—Ö –æ–±—á–∏—Å–ª–µ–Ω—å
- üõ°Ô∏è –ü–æ–∫—Ä–∞—â–µ–Ω–∞ –æ–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫
- üì± –ö—Ä–∞—â–∏–π UX –∑ –∞–Ω—ñ–º–∞—Ü—ñ—è–º–∏

## üé® CSS –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó

### CSS –∑–º—ñ–Ω–Ω—ñ:
```css
:root {
    --primary-color: #2266aa;
    --secondary-color: #32c66b;
    --background-color: #f7fbff;
    --border-color: #bbb;
    --shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    --transition: all 0.2s ease;
}
```

### –ü–µ—Ä–µ–≤–∞–≥–∏:
- üé® –õ–µ–≥–∫–µ –∫–µ—Ä—É–≤–∞–Ω–Ω—è –∫–æ–ª—å–æ—Ä–∞–º–∏
- üì± –ê–¥–∞–ø—Ç–∏–≤–Ω–∏–π –¥–∏–∑–∞–π–Ω
- üåô –ü—ñ–¥—Ç—Ä–∏–º–∫–∞ —Ç–µ–º–Ω–æ—ó —Ç–µ–º–∏
- ‚ö° –ü–æ–∫—Ä–∞—â–µ–Ω–∞ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å

## ‚öôÔ∏è Backend –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó

### –ö–µ—à—É–≤–∞–Ω–Ω—è:
```python
def get_cached_data(key, callback, timeout=CACHE_TIMEOUT):
    cached_data = cache.get(key)
    if cached_data is None:
        cached_data = callback()
        cache.set(key, cached_data, timeout)
    return cached_data
```

### –û–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω—ñ –∑–∞–ø–∏—Ç–∏:
```python
# –ó–∞–º—ñ—Å—Ç—å
client = Client.objects.get(id=client_id)

# –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ
client = Client.objects.select_related('agent').prefetch_related(
    'vending_templates__buttons__drink__norms__product'
).get(id=client_id)
```

## üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–∏—Ö

### –†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω—ñ —ñ–Ω–¥–µ–∫—Å–∏:

```sql
-- –ö–ª—ñ—î–Ω—Ç–∏
CREATE INDEX client_name_idx ON kavacrm_client(name);
CREATE INDEX client_agent_idx ON kavacrm_client(agent);
CREATE INDEX client_active_idx ON kavacrm_client(is_active);

-- –ú–∞—Ä—à—Ä—É—Ç–∏
CREATE INDEX route_agent_day_cycle_idx ON kavacrm_route(agent, visit_day, week_cycle);
CREATE INDEX route_processed_idx ON kavacrm_route(processed);

-- –í—ñ–∑–∏—Ç–∏
CREATE INDEX visit_client_date_idx ON kavacrm_visit(client_id, date DESC);
```

### –û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è –∑–∞–ø–∏—Ç—ñ–≤:
- –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è `select_related()` –¥–ª—è ForeignKey
- –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è `prefetch_related()` –¥–ª—è ManyToMany
- –û–±–º–µ–∂–µ–Ω–Ω—è –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –æ–±'—î–∫—Ç—ñ–≤ `[:limit]`
- –£–Ω–∏–∫–Ω–µ–Ω–Ω—è N+1 –ø—Ä–æ–±–ª–µ–º–∏

## üíæ –ö–µ—à—É–≤–∞–Ω–Ω—è

### –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∫–µ—à—É:
```python
CACHE_CONFIG = {
    'CLIENT_DATA': 300,      # 5 —Ö–≤–∏–ª–∏–Ω
    'APARAT_LIST': 600,      # 10 —Ö–≤–∏–ª–∏–Ω
    'ROUTE_DATA': 300,       # 5 —Ö–≤–∏–ª–∏–Ω
    'STOCK_DATA': 1800,      # 30 —Ö–≤–∏–ª–∏–Ω
    'VISIT_DATA': 60,        # 1 —Ö–≤–∏–ª–∏–Ω–∞
}
```

### –û—á–∏—â–µ–Ω–Ω—è –∫–µ—à—É:
```python
def invalidate_client_cache(client_id):
    keys_to_delete = [
        f'kavacrm:client:{client_id}',
        f'kavacrm:aparat_list:{client_id}',
        f'kavacrm:prev_visit:{client_id}',
    ]
    for key in keys_to_delete:
        cache.delete(key)
```

## üì¶ –Ü–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó –ø–æ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—é

### 1. –û–Ω–æ–≤–ª–µ–Ω–Ω—è —Ñ–∞–π–ª—ñ–≤
–í—Å—ñ –æ–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω—ñ —Ñ–∞–π–ª–∏ –≤–∂–µ –æ–Ω–æ–≤–ª–µ–Ω—ñ:
- `kavacrm/static/kavacrm/client_detail.js`
- `kavacrm/static/kavacrm/client_detail.css`
- `kavacrm/views.py`
- `kavacrm/cache_config.py`
- `kavacrm/db_optimization.py`

### 2. –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∫–µ—à—É–≤–∞–Ω–Ω—è
–î–æ–¥–∞–π—Ç–µ –≤ `settings.py`:
```python
CACHES = {
    'default': {
        'BACKEND': 'django.core.cache.backends.locmem.LocMemCache',
        'LOCATION': 'unique-snowflake',
    }
}
```

### 3. –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —ñ–Ω–¥–µ–∫—Å—ñ–≤
```bash
python manage.py shell
```
```python
from kavacrm.db_optimization import DatabaseOptimizer
optimizer = DatabaseOptimizer()
indexes = optimizer.create_indexes()
# –°—Ç–≤–æ—Ä—ñ—Ç—å —ñ–Ω–¥–µ–∫—Å–∏ –≤—Ä—É—á–Ω—É –∞–±–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ Django migrations
```

### 4. –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ–π
```bash
# –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ Django
python manage.py check

# –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞
python manage.py runserver
```

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç–∏ –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó

### –û—á—ñ–∫—É–≤–∞–Ω—ñ –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è:
- ‚ö° **–®–≤–∏–¥–∫—ñ—Å—Ç—å –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è**: +40-60%
- üíæ **–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –ø–∞–º'—è—Ç—ñ**: -20-30%
- üîÑ **–í—ñ–¥–≥—É–∫ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É**: +50-70%
- üì± **–ú–æ–±—ñ–ª—å–Ω–∞ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å**: +30-40%

### –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥:
- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ Django Debug Toolbar
- –ú–æ–Ω—ñ—Ç–æ—Ä—Ç–µ –∑–∞–ø–∏—Ç–∏ –¥–æ –ë–î
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –∫–µ—à hit/miss ratio
- –ê–Ω–∞–ª—ñ–∑—É–π—Ç–µ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å JavaScript

## üõ†Ô∏è –î–æ–¥–∞—Ç–∫–æ–≤—ñ –ø–æ—Ä–∞–¥–∏

### –î–ª—è –ø–æ–¥–∞–ª—å—à–æ—ó –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó:
1. **CDN** –¥–ª—è —Å—Ç–∞—Ç–∏—á–Ω–∏—Ö —Ñ–∞–π–ª—ñ–≤
2. **Gzip** —Å—Ç–∏—Å–Ω–µ–Ω–Ω—è
3. **HTTP/2** –ø—ñ–¥—Ç—Ä–∏–º–∫–∞
4. **Service Workers** –¥–ª—è –∫–µ—à—É–≤–∞–Ω–Ω—è
5. **Lazy loading** –¥–ª—è –∑–æ–±—Ä–∞–∂–µ–Ω—å
6. **Database connection pooling**

### –ë–µ–∑–ø–µ–∫–∞:
- –í–∞–ª—ñ–¥–∞—Ü—ñ—è –≤—Å—ñ—Ö –≤—Ö—ñ–¥–Ω–∏—Ö –¥–∞–Ω–∏—Ö
- CSRF –∑–∞—Ö–∏—Å—Ç
- SQL injection –∑–∞—Ö–∏—Å—Ç
- XSS –∑–∞—Ö–∏—Å—Ç

## üìû –ü—ñ–¥—Ç—Ä–∏–º–∫–∞

–Ø–∫—â–æ –≤–∏–Ω–∏–∫–ª–∏ –ø–∏—Ç–∞–Ω–Ω—è –∞–±–æ –ø—Ä–æ–±–ª–µ–º–∏:
1. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ª–æ–≥–∏ Django
2. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ Django Debug Toolbar
3. –ú–æ–Ω—ñ—Ç–æ—Ä—Ç–µ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å –±—Ä–∞—É–∑–µ—Ä–∞
4. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∫–µ—à—É

---

**üéâ –í—ñ—Ç–∞—î–º–æ! –í–∞—à KavaCRM —Ç–µ–ø–µ—Ä –æ–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–∏–π —Ç–∞ –≥–æ—Ç–æ–≤–∏–π –¥–æ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—ó —Ä–æ–±–æ—Ç–∏!** 